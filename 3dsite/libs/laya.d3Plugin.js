!function(window,document,Laya){Laya.un,Laya.uns,Laya.static;var __class=Laya.class,__getset=Laya.getset,Component=(Laya.__newvec,laya.components.Component);laya.d3.core.MeshTerrainSprite3D,laya.d3.core.Sprite3D,function(_super){function PathFind(){this._meshTerrainSprite3D=null,this._finder=null,this._setting=null,this.grid=null,PathFind.__super.call(this)}__class(PathFind,"laya.d3.component.PathFind",Component);var __proto=PathFind.prototype;__proto._onAdded=function(){if(!(this.owner instanceof laya.d3.core.MeshTerrainSprite3D))throw new Error("PathFinding: The owner must MeshTerrainSprite3D!");this._meshTerrainSprite3D=this.owner},__proto.findPath=function(startX,startZ,endX,endZ){var minX=this._meshTerrainSprite3D.minX,minZ=this._meshTerrainSprite3D.minZ,cellX=this._meshTerrainSprite3D.width/this.grid.width,cellZ=this._meshTerrainSprite3D.depth/this.grid.height,halfCellX=cellX/2,halfCellZ=cellZ/2,gridStartX=Math.floor((startX-minX)/cellX),gridStartZ=Math.floor((startZ-minZ)/cellZ),gridEndX=Math.floor((endX-minX)/cellX),gridEndZ=Math.floor((endZ-minZ)/cellZ),boundWidth=this.grid.width-1,boundHeight=this.grid.height-1;gridStartX>boundWidth&&(gridStartX=boundWidth),gridStartZ>boundHeight&&(gridStartZ=boundHeight),gridStartX<0&&(gridStartX=0),gridStartZ<0&&(gridStartZ=0),gridEndX>boundWidth&&(gridEndX=boundWidth),gridEndZ>boundHeight&&(gridEndZ=boundHeight),gridEndX<0&&(gridEndX=0),gridEndZ<0&&(gridEndZ=0);var path=this._finder.findPath(gridStartX,gridStartZ,gridEndX,gridEndZ,this.grid);this.grid.reset();for(var i=1;i<path.length-1;i++){var gridPos=path[i];gridPos[0]=gridPos[0]*cellX+halfCellX+minX,gridPos[1]=gridPos[1]*cellZ+halfCellZ+minZ}return 1==path.length?(path[0][0]=endX,path[0][1]=endX):path.length>1&&(path[0][0]=startX,path[0][1]=startZ,path[path.length-1][0]=endX,path[path.length-1][1]=endZ),path},__getset(0,__proto,"setting",function(){return this._setting},function(value){value&&(this._finder=new PathFinding.finders.AStarFinder(value)),this._setting=value})}()}(window,document,Laya);